RewriteEngine On

# Prevent directory listing
Options -Indexes

# Redirect to index if accessing root
DirectoryIndex index.html

# API routes - MUST come first, pass through without modification
# Check for /api/ in the path
RewriteCond %{REQUEST_URI} /api/ [NC]
RewriteRule . - [L]

# Check for /admin/api/ in the path
RewriteCond %{REQUEST_URI} /admin/api/ [NC]
RewriteRule . - [L]

# Admin directory - redirect to index.php
RewriteRule ^admin/?$ admin/index.php [L]

# Remove .php extension from URLs (external redirect) - but NOT for API
RewriteCond %{THE_REQUEST} \s([^.]+)\.php [NC]
RewriteCond %{REQUEST_URI} !/api/
RewriteCond %{REQUEST_URI} !/admin/api/
RewriteRule ^ %1 [R=301,L]

# Add .php extension internally - but NOT for API
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_URI} !/api/
RewriteCond %{REQUEST_URI} !/admin/api/
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^(.*)$ $1.php [L]

# Allow access to uploads
RewriteRule ^uploads/(.*)$ uploads/$1 [L]

# Allow access to template assets
RewriteRule ^template/(.*)$ template/$1 [L]

# Allow access to vendor (Composer)
RewriteRule ^vendor/(.*)$ vendor/$1 [L]
